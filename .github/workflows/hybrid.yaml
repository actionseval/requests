name: hybrid

on: workflow_dispatch

jobs:
  build:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os:
          - ubuntu-latest
        python-version:
          - '3.8'
      fail-fast: false
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: ${{ matrix.python-version }}
      - name: Install Dependencies
        run: |
          pip install importlib_metadata==8.5.0 importlib_resources==6.4.5
      - run: |
          make
      - run: |
          make ci

  no_chardet:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os:
          - ubuntu-latest
        python-version:
          - '3.8'
      fail-fast: false
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: ${{ matrix.python-version }}
      - name: Install Dependencies
        run: |
          libpython3.8-minimal:amd64 python3.8-distutils
          pip install importlib_metadata==8.5.0 importlib_resources==6.4.5
      - run: |
          make
      - run: |
          python -m pip uninstall -y "charset_normalizer" "chardet"
      - run: |
          make ci

  urllib3:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os:
          - ubuntu-latest
        python-version:
          - '3.8'
      fail-fast: false
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: ${{ matrix.python-version }}
      - name: Install Dependencies
        run: |
          libpython3.8-minimal:amd64 libpython3.8-stdlib:amd64 python3.8-distutils
          pip install importlib_metadata==8.5.0 importlib_resources==6.4.5
      - run: |
          make
      - run: |
          python -m pip install "urllib3<2"
      - run: |
          make ci
